# Egregore Node Configuration
#
# CLI flags override values in this file.
# Delete or comment out any field to use its default.

# Data directory for identity and database.
# Default: ./data
data_dir: ./data

# HTTP API port (localhost only).
# Default: 7654
port: 7654

# Gossip TCP port (binds to all interfaces).
# Default: 7655
gossip_port: 7655

# Seconds between gossip sync cycles.
# Default: 300 (5 minutes)
gossip_interval_secs: 300

# Network key for isolation. Nodes with different keys cannot communicate.
# Default: egregore-network-v1
network_key: egregore-network-v1

# Enable UDP LAN peer discovery.
# Default: false
lan_discovery: false

# UDP port for LAN discovery broadcasts.
# Default: 7656
discovery_port: 7656

# Enable mDNS/Bonjour peer discovery.
# Works across tailnets and networks where UDP broadcast doesn't propagate.
# Discoverable via `dns-sd -B _egregore._tcp` or `avahi-browse`.
# Default: false
mdns_discovery: false

# mDNS service type for peer discovery.
# Default: _egregore._tcp.local.
mdns_service: "_egregore._tcp.local."

# Static peer addresses for gossip replication.
# Merged with peers discovered via LAN and stored in the database.
# CLI --peer flags append to this list.
# Format: host:port
#
# Example:
# peers:
#   - 192.168.1.100:7655
#   - relay.example.com:7661
peers: []

# Hook definitions. Each hook fires independently on message events.
# Hooks run in parallel. Each can have its own timeout.
# CLI --hook-on-message/--hook-webhook-url append an additional hook.
#
# Hook fields:
#   name:             Human-readable label (used as idempotency key)
#   on_message:       Path to subprocess script (message JSON on stdin)
#   webhook_url:      URL to POST message JSON
#   timeout_secs:     Execution timeout (default: 30)
#   max_retries:      Retry count for failures/timeouts (default: 0 = no retries)
#   retry_delay_secs: Delay between retries (default: 5)
#   idempotent:       Track completion to skip duplicates (default: false)
#
# Example:
# hooks:
#   - name: discord-notify
#     on_message: ./hooks/discord-notify.sh
#     timeout_secs: 10
#   - name: insight-webhook
#     webhook_url: https://example.com/hooks/egregore
#     timeout_secs: 15
#   - name: reliable-pipeline
#     on_message: ./hooks/process.sh
#     webhook_url: https://example.com/hooks/backup
#     timeout_secs: 30
#     max_retries: 3
#     retry_delay_secs: 10
#     idempotent: true
hooks: []

# Push-based replication settings.
# When enabled, connections attempt to negotiate persistent mode for
# real-time message propagation (in addition to periodic pull sync).

# Enable persistent push connections.
# Default: true
push_enabled: true

# Maximum number of persistent connections to maintain.
# Applies to both incoming and outgoing persistent connections.
# Default: 32
max_persistent_connections: 32

# Initial delay for reconnection attempts (in seconds).
# Uses exponential backoff with jitter.
# Default: 5
reconnect_initial_secs: 5

# Maximum delay for reconnection attempts (in seconds).
# Default: 300 (5 minutes)
reconnect_max_secs: 300

# Retention and expiration settings.
# Messages can expire via per-message TTL (expires_at field) or retention policies.

# Enable automatic retention cleanup.
# When enabled, a background task periodically deletes expired messages
# and applies retention policies.
# Default: false
retention_enabled: false

# Interval in seconds between retention cleanup runs.
# Default: 3600 (1 hour)
retention_interval_secs: 3600

# How long to keep tombstones (deleted message records) in seconds.
# Tombstones track deleted messages for replication consistency.
# Default: 604800 (7 days)
tombstone_max_age_secs: 604800

# Retention policies are configured via the API:
#   POST /v1/retention/policies
#
# Example policies:
#   - Global max age: delete all messages older than 30 days
#   - Topic-specific: keep only 1000 messages per topic
#   - Compaction: keep only latest message per key (Kafka-style)
